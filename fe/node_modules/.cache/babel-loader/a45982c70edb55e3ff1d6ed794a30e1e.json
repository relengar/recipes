{"ast":null,"code":"import _slicedToArray from \"/Users/dude/Documents/stuff/recipes/fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"/Users/dude/Documents/stuff/recipes/fe/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nvar _jsxFileName = \"/Users/dude/Documents/stuff/recipes/fe/src/components/shoppingList/view_shopping_list/ViewShoppingList.tsx\";\nimport React from 'react';\nimport { useQuery, useLazyQuery, useSubscription } from '@apollo/react-hooks';\nimport { GET_SHOPPING_LIST, INGREDIENTS_SUBSCRIPTION } from './view_shopping_list.query';\nimport { useParams } from 'react-router-dom';\nimport { GET_RECIPE } from '../../recipe/recipe_view/recipe_view.query';\nimport { flattenSteps } from '../../util/helpers/flattenSteps';\nimport { CircularProgress } from '@material-ui/core';\nimport MyIngredients from './my_ingredients/MyIngredients';\n\nfunction mapWsUpdates(ingredients, updates) {\n  if (!(updates === null || updates === void 0 ? void 0 : updates.length)) {\n    return ingredients;\n  }\n\n  return ingredients.map(ingredient => {\n    var _ingredient$update;\n\n    const update = updates.find(({\n      id\n    }) => id === ingredient.id);\n    return (_ingredient$update = _objectSpread({}, ingredient, {}, update)) !== null && _ingredient$update !== void 0 ? _ingredient$update : ingredient;\n  });\n}\n\nfunction ViewShoppingList() {\n  const _useParams = useParams(),\n        id = _useParams.id;\n\n  const _useLazyQuery = useLazyQuery(GET_RECIPE),\n        _useLazyQuery2 = _slicedToArray(_useLazyQuery, 2),\n        getRecipe = _useLazyQuery2[0],\n        _useLazyQuery2$ = _useLazyQuery2[1],\n        recipeData = _useLazyQuery2$.data,\n        loadingRecipe = _useLazyQuery2$.loading;\n\n  const _useQuery = useQuery(GET_SHOPPING_LIST, {\n    variables: {\n      id\n    },\n    onCompleted: ({\n      getShoppingListById: {\n        recipeId\n      }\n    }) => getRecipe({\n      variables: {\n        recipeId\n      }\n    })\n  }),\n        data = _useQuery.data,\n        loading = _useQuery.loading;\n\n  const _useSubscription = useSubscription(INGREDIENTS_SUBSCRIPTION, {\n    variables: {\n      userId: '5e03a6a91841d1fce86f9292'\n    }\n  }),\n        socketData = _useSubscription.data;\n\n  const shoppingList = data === null || data === void 0 ? void 0 : data.getShoppingListById; // const [ ingredients, setIngredients ] =  React.useState<any>(shoppingList?.ingredients ?? [])\n\n  const recipe = recipeData === null || recipeData === void 0 ? void 0 : recipeData.recipeById;\n  return React.createElement(\"section\", {\n    className: \"section\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 36\n    },\n    __self: this\n  }, loading && React.createElement(\"div\", {\n    className: \"container has-text-centered\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 37\n    },\n    __self: this\n  }, React.createElement(CircularProgress, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 37\n    },\n    __self: this\n  })), shoppingList && React.createElement(React.Fragment, null, React.createElement(\"h1\", {\n    className: \"title has-text-centered\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 41\n    },\n    __self: this\n  }, shoppingList.recipeTitle), React.createElement(\"div\", {\n    className: \"columns is-two-thirds is-centered\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 42\n    },\n    __self: this\n  }, React.createElement(MyIngredients, {\n    userId: '5e03a6a91841d1fce86f9292',\n    ingredients: mapWsUpdates(socketData === null || socketData === void 0 ? void 0 : socketData.shoppingListIngredients, shoppingList.ingredients),\n    listId: shoppingList.id,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 43\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49\n    },\n    __self: this\n  }, loadingRecipe && React.createElement(\"div\", {\n    className: \"container has-text-centered\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50\n    },\n    __self: this\n  }, React.createElement(CircularProgress, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50\n    },\n    __self: this\n  })), recipe && React.createElement(React.Fragment, null, React.createElement(\"div\", {\n    className: \"columns is-one-quarter is-centered\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: recipe.image,\n    alt: recipe.title,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57\n    },\n    __self: this\n  }, recipe.analyzedInstructions.reduce(flattenSteps, []).map(({\n    step\n  }, i) => React.createElement(\"div\", {\n    key: i,\n    className: \"box has-text-centered\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62\n    },\n    __self: this\n  }, step)))))));\n}\n\nexport default ViewShoppingList;","map":{"version":3,"sources":["/Users/dude/Documents/stuff/recipes/fe/src/components/shoppingList/view_shopping_list/ViewShoppingList.tsx"],"names":["React","useQuery","useLazyQuery","useSubscription","GET_SHOPPING_LIST","INGREDIENTS_SUBSCRIPTION","useParams","GET_RECIPE","flattenSteps","CircularProgress","MyIngredients","mapWsUpdates","ingredients","updates","length","map","ingredient","update","find","id","ViewShoppingList","getRecipe","recipeData","data","loadingRecipe","loading","variables","onCompleted","getShoppingListById","recipeId","userId","socketData","shoppingList","recipe","recipeById","recipeTitle","shoppingListIngredients","image","title","analyzedInstructions","reduce","step","i"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { useQuery, useLazyQuery, useSubscription } from '@apollo/react-hooks';\nimport { GET_SHOPPING_LIST, INGREDIENTS_SUBSCRIPTION } from './view_shopping_list.query';\nimport { useParams } from 'react-router-dom';\nimport { GET_RECIPE } from '../../recipe/recipe_view/recipe_view.query';\nimport { flattenSteps } from '../../util/helpers/flattenSteps';\nimport { CircularProgress } from '@material-ui/core';\nimport MyIngredients from './my_ingredients/MyIngredients';\n\nfunction mapWsUpdates(ingredients: any[], updates: any[]) {\n    if (!updates?.length) {\n       return  ingredients;\n    }\n    return ingredients.map(ingredient => {\n        const update = updates.find(({id}) => id === ingredient.id)\n        return { ...ingredient, ...update } ?? ingredient;\n    })\n}\n\nfunction ViewShoppingList() {\n    const { id } = useParams();\n    const [ getRecipe, { data: recipeData, loading: loadingRecipe } ] = useLazyQuery(GET_RECIPE)\n    const { data, loading } = useQuery(GET_SHOPPING_LIST, {\n        variables: { id },\n        onCompleted: ({getShoppingListById: { recipeId }}) => getRecipe({variables: { recipeId }})\n    });\n    const { data: socketData } = useSubscription(INGREDIENTS_SUBSCRIPTION, {\n        variables: { userId: '5e03a6a91841d1fce86f9292' },\n    });\n\n    const shoppingList = data?.getShoppingListById;\n    // const [ ingredients, setIngredients ] =  React.useState<any>(shoppingList?.ingredients ?? [])\n    const recipe = recipeData?.recipeById;\n\n    return (\n        <section className=\"section\">\n            {loading && <div className=\"container has-text-centered\"><CircularProgress /></div>}\n            {\n                shoppingList &&\n                <>\n                    <h1 className=\"title has-text-centered\">{shoppingList.recipeTitle}</h1>\n                    <div className=\"columns is-two-thirds is-centered\">\n                        <MyIngredients\n                            userId={'5e03a6a91841d1fce86f9292'}\n                            ingredients={mapWsUpdates(socketData?.shoppingListIngredients, shoppingList.ingredients)}\n                            listId={shoppingList.id}\n                        />\n                    </div>\n                    <div className=\"container\">\n                        {loadingRecipe && <div className=\"container has-text-centered\"><CircularProgress /></div>}\n                        {\n                            recipe &&\n                            <>\n                                <div className=\"columns is-one-quarter is-centered\">\n                                    <img src={recipe.image} alt={recipe.title}/>\n                                </div>\n                                <div className=\"container\">\n                                    {\n                                        recipe.analyzedInstructions\n                                            .reduce(flattenSteps, [])\n                                            .map(({step}: {step: string}, i: number) => (\n                                            <div key={i} className=\"box has-text-centered\">{step}</div>\n                                        ))\n                                    }\n                                </div>\n                            </>\n                        }\n                    </div>\n                </>\n            }\n        </section>\n    );\n}\n\nexport default ViewShoppingList;"]},"metadata":{},"sourceType":"module"}