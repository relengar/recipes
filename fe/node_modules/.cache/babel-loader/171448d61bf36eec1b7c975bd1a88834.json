{"ast":null,"code":"import _regeneratorRuntime from\"/Users/dude/Documents/stuff/recipes/fe/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/dude/Documents/stuff/recipes/fe/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/dude/Documents/stuff/recipes/fe/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{Formik,Form,Field,ErrorMessage}from'formik';import{AuthType}from'../navbar.model';import{useMutation}from'@apollo/react-hooks';import{SIGNUP,LOGIN}from'./auth_module_query';import{formatError}from'../../util/helpers/formatError';import Dialog from'@material-ui/core/Dialog';import DialogContent from'@material-ui/core/DialogContent';function onError(err){console.log(err);}function getText(authType){switch(authType){case AuthType.LOGIN:return'Log In';case AuthType.SIGNUP:return'Sign Up';default:return'';}}function AuthModule(_ref){var loadUser=_ref.loadUser,authType=_ref.authType;var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),open=_React$useState2[0],setOpen=_React$useState2[1];var options={onCompleted:function onCompleted(){client===null||client===void 0?void 0:client.resetStore();loadUser();setOpen(false);},onError:onError};var _useMutation=useMutation(SIGNUP,options),_useMutation2=_slicedToArray(_useMutation,2),signup=_useMutation2[0],_useMutation2$=_useMutation2[1],regError=_useMutation2$.error,client=_useMutation2$.client;var _useMutation3=useMutation(LOGIN,options),_useMutation4=_slicedToArray(_useMutation3,2),login=_useMutation4[0],logError=_useMutation4[1].error;var call=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(type,config){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=type;_context.next=_context.t0===AuthType.LOGIN?3:_context.t0===AuthType.SIGNUP?6:9;break;case 3:_context.next=5;return login(config);case 5:return _context.abrupt(\"return\",_context.sent);case 6:_context.next=8;return signup(config);case 8:return _context.abrupt(\"return\",_context.sent);case 9:case\"end\":return _context.stop();}}},_callee);}));return function call(_x,_x2){return _ref2.apply(this,arguments);};}();var error=regError!==null&&regError!==void 0?regError:logError;return React.createElement(React.Fragment,null,React.createElement(\"button\",{onClick:function onClick(){return setOpen(true);},className:\"button\"},getText(authType)),React.createElement(Dialog,{onClose:function onClose(){return setOpen(false);},open:open},React.createElement(DialogContent,null,React.createElement(Formik,{initialValues:{name:'',password:''},onSubmit:/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values,_ref4){var setSubmitting;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setSubmitting=_ref4.setSubmitting;_context2.next=3;return call(authType,{variables:values});case 3:setSubmitting(false);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x3,_x4){return _ref3.apply(this,arguments);};}(),validate:function validate(values){var required=['name','password'];var errors=Object.entries(values).filter(function(_ref5){var _ref6=_slicedToArray(_ref5,2),key=_ref6[0],val=_ref6[1];return required.some(function(r){return r===key&&val==='';});}).map(function(_ref7){var _ref8=_slicedToArray(_ref7,1),key=_ref8[0];return[key,'This field is required'];});return Object.fromEntries(errors);}},function(_ref9){var isSubmitting=_ref9.isSubmitting;return React.createElement(Form,null,React.createElement(\"div\",{className:\"field\"},React.createElement(\"label\",{className:\"label\"},\"Username\"),React.createElement(Field,{placeholder:\"enter username\",className:\"input\",name:\"name\",type:\"text\"}),React.createElement(ErrorMessage,{className:\"has-text-danger\",name:\"name\",component:\"div\"})),React.createElement(\"div\",{className:\"field\"},React.createElement(\"label\",{className:\"label\"},\"Password\"),React.createElement(Field,{placeholder:\"type password\",className:\"input\",name:\"password\",type:\"password\"}),React.createElement(ErrorMessage,{className:\"has-text-danger\",name:\"password\",component:\"div\"})),React.createElement(\"button\",{type:\"submit\",className:\"button is-success is-fullwidth\",disabled:isSubmitting},getText(authType)),error&&React.createElement(\"div\",{className:\"has-text-centered\"},React.createElement(\"p\",{className:\"help is-danger\"},formatError(error))));}))));}export default AuthModule;","map":{"version":3,"sources":["/Users/dude/Documents/stuff/recipes/fe/src/components/navbar/authModule/AuthModule.tsx"],"names":["React","Formik","Form","Field","ErrorMessage","AuthType","useMutation","SIGNUP","LOGIN","formatError","Dialog","DialogContent","onError","err","console","log","getText","authType","AuthModule","loadUser","useState","open","setOpen","options","onCompleted","client","resetStore","signup","regError","error","login","logError","call","type","config","name","password","values","setSubmitting","variables","required","errors","Object","entries","filter","key","val","some","r","map","fromEntries","isSubmitting"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Formik, Form, Field, ErrorMessage } from 'formik';\nimport { AuthType } from '../navbar.model';\nimport { useMutation } from '@apollo/react-hooks';\nimport { SIGNUP, LOGIN } from './auth_module_query';\nimport { formatError } from '../../util/helpers/formatError';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport { OperationVariables } from 'apollo-boost';\n\ntype AuthProps = {\n    loadUser: () => void,\n    authType: AuthType,\n}\n\nfunction onError(err: any): void {console.log(err)}\n\nfunction getText(authType: AuthType): string {\n    switch (authType) {\n        case AuthType.LOGIN:\n            return 'Log In';\n        case AuthType.SIGNUP:\n            return 'Sign Up';\n        default:\n            return '';\n    }\n}\n\nfunction AuthModule({ loadUser, authType }: AuthProps) {\n    const [ open, setOpen ] = React.useState(false);\n    const options = {\n        onCompleted: () => {\n            client?.resetStore();\n            loadUser()\n            setOpen(false)\n        },\n        onError\n    }\n    const [ signup, { error: regError, client } ] = useMutation(SIGNUP, options);\n    const [ login, { error: logError } ] = useMutation(LOGIN, options);\n    const call =  async (type: AuthType, config: { variables: OperationVariables }) => {\n        switch (type) {\n            case AuthType.LOGIN:\n                return await login(config);\n            case AuthType.SIGNUP:\n                return await signup(config);\n        }\n    } \n\n    const error = regError ?? logError;\n\n    return (\n        <>\n            <button onClick={() => setOpen(true)} className=\"button\">{getText(authType)}</button>\n            <Dialog onClose={() => setOpen(false)} open={open}>\n                <DialogContent>\n                    <Formik\n                        initialValues={{ name: '', password: ''}}\n                        onSubmit={async (values, { setSubmitting }) => {\n                            await call(authType, {variables: values});\n                            setSubmitting(false);\n                        }}\n                        validate={(values) => {\n                            const required = ['name', 'password'];\n                            const errors = Object.entries(values)\n                                .filter(([key, val]) => required.some(r => r === key && val === ''))\n                                .map(([key]) => ([key, 'This field is required']))\n                            return Object.fromEntries(errors);\n                        }}\n                    >\n                        {({isSubmitting}) => (\n                            <Form>\n                                <div className=\"field\">\n                                    <label className=\"label\">Username</label>\n                                    <Field placeholder=\"enter username\" className=\"input\" name=\"name\" type=\"text\"></Field>\n                                    <ErrorMessage className=\"has-text-danger\" name=\"name\" component=\"div\"></ErrorMessage>\n                                </div>\n                                <div className=\"field\">\n                                    <label className=\"label\">Password</label>\n                                    <Field placeholder=\"type password\" className=\"input\" name=\"password\" type=\"password\"></Field>\n                                    <ErrorMessage className=\"has-text-danger\" name=\"password\" component=\"div\"></ErrorMessage>\n                                </div>\n                                <button type=\"submit\" className=\"button is-success is-fullwidth\" disabled={isSubmitting}>\n                                    {getText(authType)}\n                                </button>\n                                {\n                                    error &&\n                                    <div className=\"has-text-centered\">\n                                        <p className=\"help is-danger\">{formatError(error)}</p>\n                                    </div>\n                                }\n                            </Form>\n                        )}\n                    </Formik>\n                </DialogContent>\n            </Dialog>\n        </>\n    );\n}\n\nexport default AuthModule;"]},"metadata":{},"sourceType":"module"}